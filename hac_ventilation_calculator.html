<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAC and Ventilation Calculator</title>
    <style>
        :root {
            --bg: #0f172a;
            --panel: #111827;
            --ink: #e5e7eb;
            --muted: #94a3b8;
            --brand: #22d3ee;
            --accent: #34d399;
            --danger: #ef4444;
            --warn: #f59e0b;
            --ok: #10b981;
            --code: #0b1021;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #0b1021, #111827);
            color: var(--ink);
            line-height: 1.6;
            min-height: 100vh;
            padding: 0 10px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--brand), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            color: var(--muted);
            font-size: 1.1rem;
        }
        
        .language-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
        }
        
        .language-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: bold;
        }
        
        .language-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .language-btn.active {
            background: white;
            color: #1a6fb0;
        }
        
        .scenario-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .scenario-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            min-width: 150px;
        }
        
        .scenario-btn.active {
            background: linear-gradient(135deg, var(--brand), var(--accent));
            color: #001;
            border-color: var(--brand);
        }
        
        .scenario-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--brand);
            color: var(--brand);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .card-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--brand);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 8px;
        }
        
        .input-group {
            display: grid;
            grid-template-columns: 1.8fr 1fr 0.7fr;
            gap: 10px;
            align-items: center;
            margin: 12px 0;
        }
        
        .input-group label {
            color: var(--muted);
            font-size: 0.9rem;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            background: var(--code);
            color: var(--ink);
            border: 1px solid #1f2937;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .input-group .unit {
            color: var(--muted);
            font-size: 0.8rem;
            text-align: right;
        }
        
        .pressure-type {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }
        
        .pressure-type label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            color: var(--muted);
        }
        
        .explanation {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 12px;
            margin-top: 8px;
            font-size: 0.85rem;
            color: var(--muted);
            line-height: 1.4;
        }
        
        .formula {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: var(--accent);
        }
        
        .formula-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--brand);
        }
        
        .formula-explanation {
            font-size: 0.8rem;
            color: var(--muted);
            margin-top: 8px;
        }
        
        .location-explanation {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-size: 0.9rem;
        }
        
        .location-explanation h4 {
            color: var(--brand);
            margin-bottom: 8px;
        }
        
        .results {
            background: var(--code);
            border: 1px dashed #334155;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
        }
        
        .result-value {
            font-weight: bold;
            color: var(--accent);
        }
        
        .result-details {
            font-size: 0.8rem;
            color: var(--muted);
            margin-top: 5px;
        }
        
        .pill {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 8px;
            font-weight: bold;
        }
        
        .pill.ok {
            background: rgba(16, 185, 129, 0.15);
            color: #a7f3d0;
            border: 1px solid rgba(16, 185, 129, 0.35);
        }
        
        .pill.warn {
            background: rgba(245, 158, 11, 0.12);
            color: #fde68a;
            border: 1px solid rgba(245, 158, 11, 0.35);
        }
        
        .pill.bad {
            background: rgba(239, 68, 68, 0.12);
            color: #fecaca;
            border: 1px solid rgba(239, 68, 68, 0.35);
        }
        
        .btn {
            cursor: pointer;
            background: linear-gradient(135deg, var(--brand), var(--accent));
            color: #001;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            width: 100%;
            margin-top: 10px;
            transition: opacity 0.3s ease;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .btn.secondary {
            background: transparent;
            color: var(--ink);
            border: 1px solid #334155;
        }
        
        .hint {
            color: var(--muted);
            font-size: 0.8rem;
            margin-top: 10px;
            line-height: 1.4;
        }
        
        .summary {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .summary-title {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: var(--brand);
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .summary-item {
            background: var(--code);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--accent);
        }
        
        .summary-item h3 {
            font-size: 1rem;
            margin-bottom: 8px;
            color: var(--muted);
        }
        
        .summary-item p {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent);
        }
        
        .footer {
            margin-top: 30px;
            text-align: center;
            color: var(--muted);
            font-size: 0.8rem;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        details {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
        }
        
        summary {
            cursor: pointer;
            color: #cbd5e1;
            font-weight: 600;
        }

        .calculation-steps {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }
        
        .calculation-step {
            margin: 8px 0;
            padding: 5px;
            border-left: 3px solid var(--brand);
            padding-left: 10px;
        }
        
        .step-number {
            font-weight: bold;
            color: var(--brand);
        }
        
        .type-a-opening {
            background: rgba(34, 211, 238, 0.1);
            border: 1px solid var(--brand);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .type-a-opening h4 {
            color: var(--brand);
            margin-bottom: 10px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .warning-banner {
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.35);
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            color: #fecaca;
            font-size: 0.9rem;
        }
        
        .info-banner {
            background: rgba(34, 211, 238, 0.15);
            border: 1px solid rgba(34, 211, 238, 0.35);
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            color: #a7f3d0;
            font-size: 0.9rem;
        }
        
        .conservative-mode-toggle {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .conservative-mode-toggle h4 {
            color: var(--warn);
            margin-bottom: 8px;
        }
        
        .toggle-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .toggle-group label {
            color: var(--muted);
            font-size: 0.9rem;
        }
        
        .toggle-group input[type="checkbox"] {
            width: auto;
        }
        
        .calculation-log {
            background: var(--code);
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 3px;
            border-left: 2px solid var(--brand);
            padding-left: 8px;
        }
        
        .log-time {
            color: var(--muted);
            font-size: 0.7rem;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .input-group {
                grid-template-columns: 1fr;
                gap: 5px;
            }
            
            .input-group .unit {
                text-align: left;
            }
            
            .language-toggle {
                position: static;
                text-align: center;
                margin-top: 15px;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                margin-right: 0;
                margin-bottom: 5px;
                border-radius: 8px;
            }
            
            .scenario-selector {
                flex-direction: column;
                align-items: center;
            }
            
            .toggle-group {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 data-en="HAC and Ventilation Calculator" data-ua="Калькулятор HAC та Вентиляції">HAC and Ventilation Calculator</h1>
            <p class="subtitle" data-en="Based on IEC 60079-10-1:2020, EN 12186:2014, IGEM TD/13 Ed.3, and BS 5925:1991" data-ua="На основі стандартів IEC 60079-10-1:2020, EN 12186:2014, IGEM TD/13 Ed.3 та BS 5925:1991">Based on IEC 60079-10-1:2020, EN 12186:2014, IGEM TD/13 Ed.3, and BS 5925:1991</p>
            
            <div class="language-toggle">
                <button class="language-btn active" data-lang="en">EN</button>
                <button class="language-btn" data-lang="ua">UA</button>
            </div>
        </header>
        
        <!-- Scenario Selector -->
        <div class="scenario-selector">
            <button class="scenario-btn active" data-scenario="outdoor" data-en="Outdoor Release" data-ua="Зовнішній викид">Outdoor Release</button>
            <button class="scenario-btn" data-scenario="indoor" data-en="Indoor Release" data-ua="Внутрішній викид">Indoor Release</button>
        </div>
        
        <div class="location-explanation">
            <h4 data-en="How Zone Calculation Works Based on Release Location" data-ua="Як розраховується зона залежно від розташування джерела">How Zone Calculation Works Based on Release Location</h4>
            <p data-en="The calculator uses different approaches for indoor and outdoor releases:" data-ua="Калькулятор використовує різні підходи для внутрішніх і зовнішніх викидів:">
                The calculator uses different approaches for indoor and outdoor releases:
            </p>
            <ul>
                <li data-en="<strong>Outdoor releases:</strong> Zone extent is calculated based on release rate, wind speed, and gas properties. Higher release rates and lower wind speeds create larger hazardous zones." data-ua="<strong>Зовнішні викиди:</strong> Протяжність зони розраховується на основі швидкості викиду, швидкості вітру та властивостей газу. Більші швидкості викиду та менші швидкості вітру створюють більші небезпечні зони.">
                    <strong>Outdoor releases:</strong> Zone extent is calculated based on release rate, wind speed, and gas properties. Higher release rates and lower wind speeds create larger hazardous zones.
                </li>
                <li data-en="<strong>Indoor releases:</strong> The entire room may become a hazardous zone if ventilation is inadequate. Zone extent depends on room size, ventilation efficiency, and background concentration of flammable gas." data-ua="<strong>Внутрішні викиди:</strong> Все приміщення може стати небезпечною зоною, якщо вентиляція недостатня. Протяжність зони залежить від розміру приміщення, ефективності вентиляції та фонової концентрації займистого газу.">
                    <strong>Indoor releases:</strong> The entire room may become a hazardous zone if ventilation is inadequate. Zone extent depends on room size, ventilation efficiency, and background concentration of flammable gas.
                </li>
                <li data-en="<strong>Type A Openings:</strong> For openings from enclosed spaces (ventilation outlets), the opening is treated as a release point according to IEC 60079-10-1 Article B.8. The volumetric flow rate Q₂ is used as release characteristic." data-ua="<strong>Отвори типу А:</strong> Для отворів із закритих просторів (вентиляційні виходи), отвір розглядається як точка викиду згідно з IEC 60079-10-1 Стаття B.8. Об'ємна витрата Q₂ використовується як характеристика викиду.">
                    <strong>Type A Openings:</strong> For openings from enclosed spaces (ventilation outlets), the opening is treated as a release point according to IEC 60079-10-1 Article B.8. The volumetric flow rate Q₂ is used as release characteristic.
                </li>
            </ul>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="gas-properties" data-en="Gas Properties" data-ua="Властивості газу">Gas Properties</div>
            <div class="tab outdoor-only" data-tab="outdoor-assessment" data-en="Outdoor Assessment" data-ua="Оцінка зовнішнього викиду">Outdoor Assessment</div>
            <div class="tab indoor-only" data-tab="indoor-assessment" data-en="Indoor Assessment" data-ua="Оцінка внутрішнього викиду">Indoor Assessment</div>
            <div class="tab indoor-only" data-tab="standards-check" data-en="Standards Compliance" data-ua="Відповідність стандартам">Standards Compliance</div>
            <div class="tab" data-tab="classification" data-en="Zone Classification" data-ua="Класифікація зони">Zone Classification</div>
        </div>
        
        <!-- Gas Properties Tab -->
        <div class="tab-content active" id="gas-properties">
            <div class="grid">
                <div class="card">
                    <h2 class="card-title" data-en="1. Gas Properties & Release Source" data-ua="1. Властивості газу та джерело викиду">1. Gas Properties & Release Source</h2>
                    
                    <div class="input-group">
                        <label for="gasType" data-en="Gas Type" data-ua="Тип газу">Gas Type</label>
                        <select id="gasType">
                            <option value="propane" data-en="Propane" data-ua="Пропан">Propane</option>
                            <option value="butane" data-en="Butane" data-ua="Бутан">Butane</option>
                            <option value="custom" data-en="Custom" data-ua="Інший">Custom</option>
                        </select>
                        <div class="unit"></div>
                    </div>
                    
                    <div class="input-group">
                        <label for="lflPreset" data-en="LFL Preset" data-ua="Попередній вибір LFL">LFL Preset</label>
                        <select id="lflPreset">
                            <option value="common" data-en="Common (2.1%)" data-ua="Загальноприйнятий (2.1%)">Common (2.1%)</option>
                            <option value="conservative" data-en="Conservative (1.7%)" data-ua="Консервативний (1.7%)">Conservative (1.7%)</option>
                            <option value="custom" data-en="Custom" data-ua="Власне значення">Custom</option>
                        </select>
                        <div class="unit"></div>
                    </div>
                    
                    <details>
                        <summary data-en="Gas Properties" data-ua="Властивості газу">Gas Properties</summary>
                        <div class="input-group">
                            <label for="molarMass" data-en="Molar Mass (M)" data-ua="Молярна маса (M)">Molar Mass (M)</label>
                            <input type="number" id="molarMass" step="0.0001" value="0.044097">
                            <div class="unit">kg/mol</div>
                        </div>
                        
                        <div class="input-group">
                            <label for="gamma" data-en="Specific Heat Ratio (γ)" data-ua="Показник адіабати (γ)">Specific Heat Ratio (γ)</label>
                            <input type="number" id="gamma" step="0.001" value="1.13">
                            <div class="unit">—</div>
                        </div>
                        
                        <div class="input-group">
                            <label for="lfl" data-en="Lower Flammable Limit (LFL)" data-ua="Нижча межа займистості (LFL)">Lower Flammable Limit (LFL)</label>
                            <input type="number" id="lfl" step="0.0001" value="0.021">
                            <div class="unit">vol/vol</div>
                        </div>
                        
                        <div class="input-group">
                            <label for="temp" data-en="Gas Temperature (T₀)" data-ua="Температура газу (T₀)">Gas Temperature (T₀)</label>
                            <input type="number" id="temp" step="0.1" value="293.15">
                            <div class="unit">K</div>
                        </div>
                    </details>
                    
                    <div class="input-group">
                        <label for="holeSize" data-en="Hole Size (S)" data-ua="Розмір отвору (S)">Hole Size (S)</label>
                        <input type="number" id="holeSize" step="0.01" value="0.25">
                        <div class="unit">mm²</div>
                    </div>
                    <div class="explanation" data-en="Area of the leak opening. For secondary releases according to IEC 60079-10-1 Table B.1, typically 0.25 mm²." data-ua="Площа отвору витоку. Для вторинних викидів згідно з IEC 60079-10-1 Таблиця B.1, зазвичай 0.25 мм².">Area of the leak opening. For secondary releases according to IEC 60079-10-1 Table B.1, typically 0.25 mm².</div>
                    
                    <div class="input-group">
                        <label for="pressure" data-en="System Pressure" data-ua="Тиск у системі">System Pressure</label>
                        <input type="number" id="pressure" step="0.1" value="4.01325">
                        <div class="unit">bar</div>
                    </div>
                    <div class="pressure-type">
                        <label>
                            <input type="radio" name="pressureType" value="absolute" checked>
                            <span data-en="Absolute" data-ua="Абсолютний">Absolute</span>
                        </label>
                        <label>
                            <input type="radio" name="pressureType" value="gauge">
                            <span data-en="Gauge" data-ua="Манометричний">Gauge</span>
                        </label>
                    </div>
                    <div class="explanation" data-en="Pressure inside the system. Select 'Absolute' for total pressure or 'Gauge' for pressure above atmospheric. Gauge pressure + 1.01325 bar = Absolute pressure." data-ua="Тиск всередині системи. Виберіть 'Абсолютний' для загального тиску або 'Манометричний' для тиску вище атмосферного. Манометричний тиск + 1.01325 бар = Абсолютний тиск.">Pressure inside the system. Select 'Absolute' for total pressure or 'Gauge' for pressure above atmospheric. Gauge pressure + 1.01325 bar = Absolute pressure.</div>
                
                    <div class="input-group">
                        <label for="cd" data-en="Discharge Coefficient (Cₕ)" data-ua="Коефіцієнт витрати (Cₕ)">Discharge Coefficient (Cₕ)</label>
                        <input type="number" id="cd" step="0.01" value="0.62">
                        <div class="unit">—</div>
                    </div>
                    <div class="explanation" data-en="Coefficient that accounts for flow contraction and friction. Typical values: 0.6-0.65 for sharp-edged orifices, 0.8-0.98 for well-rounded nozzles. Use 0.62 for standard calculations." data-ua="Коефіцієнт, що враховує стиснення потоку та тертя. Типові значення: 0.6-0.65 для отворів з гострими краями, 0.8-0.98 для добре закруглених сопел. Використовуйте 0.62 для стандартних розрахунків.">Coefficient that accounts for flow contraction and friction. Typical values: 0.6-0.65 for sharp-edged orifices, 0.8-0.98 for well-rounded nozzles. Use 0.62 for standard calculations.</div>
                
                    <div class="formula">
                        <div class="formula-title" data-en="Release Rate Calculation Formulas (IEC 60079-10-1 Annex B.7)" data-ua="Формули розрахунку швидкості викиду (IEC 60079-10-1 Додаток B.7)">Release Rate Calculation Formulas (IEC 60079-10-1 Annex B.7)</div>
                        <div data-en="Mass flow rate (choked flow):" data-ua="Масова витрата (перекритий потік):">Mass flow rate (choked flow):</div>
                        <div>ṁ = C<sub>d</sub> × S × p₀ × √(γ/(Z×R×T₀)) × (2/(γ+1))<sup>(γ+1)/(2(γ-1))</sup></div>
                        <div data-en="Mass flow rate (subsonic flow):" data-ua="Масова витрата (дозвуковий потік):">Mass flow rate (subsonic flow):</div>
                        <div>ṁ = C<sub>d</sub> × S × p₀ × √[(2γ/(Z×R×T₀×(γ-1))) × ((p<sub>d</sub>/p₀)<sup>2/γ</sup> - (p<sub>d</sub>/p₀)<sup>(γ+1)/γ</sup>)]</div>
                        <div data-en="Volumetric gas inflow (Q<sub>g</sub>):" data-ua="Об'ємний приток газу (Q<sub>g</sub>):">Volumetric gas inflow (Q<sub>g</sub>):</div>
                        <div>Q<sub>g</sub> = ṁ / ρ<sub>g</sub></div>
                        <div data-en="Volumetric release characteristic (Q<sub>c</sub>):" data-ua="Характеристика об'ємного викиду (Q<sub>c</sub>):">Volumetric release characteristic (Q<sub>c</sub>):</div>
                        <div>Q<sub>c</sub> = ṁ / (ρ<sub>g</sub> × LFL)</div>
                        <div class="formula-explanation" data-en="Where: C<sub>d</sub> - discharge coefficient, S - hole area, p₀ - stagnation pressure, γ - specific heat ratio, Z - compressibility factor, R - gas constant, T₀ - stagnation temperature, p<sub>d</sub> - downstream pressure, ρ<sub>g</sub> - gas density at atmospheric pressure, LFL - lower flammable limit" data-ua="Де: C<sub>d</sub> - коефіцієнт витрати, S - площа отвору, p₀ - стагнаційний тиск, γ - показник адіабати, Z - коефіцієнт стисливості, R - газова постійна, T₀ - стагнаційна температура, p<sub>d</sub> - тиск downstream, ρ<sub>g</sub> - щільність газу при атмосферному тиску, LFL - нижча межа займистості">Where: C<sub>d</sub> - discharge coefficient, S - hole area, p₀ - stagnation pressure, γ - specific heat ratio, Z - compressibility factor, R - gas constant, T₀ - stagnation temperature, p<sub>d</sub> - downstream pressure, ρ<sub>g</sub> - gas density at atmospheric pressure, LFL - lower flammable limit</div>
                    </div>
                
                    <button class="btn" id="calculateRelease" data-en="Calculate Release Rate" data-ua="Розрахувати швидкість викиду">Calculate Release Rate</button>
                
                    <div class="calculation-log" id="releaseCalculationLog">
                        <!-- Log will be populated here -->
                    </div>
                
                    <div class="results" id="releaseResults">
                        <!-- Results will be populated here -->
                    </div>
                
                    <p class="hint" data-en="Calculates mass and volumetric release rates based on IEC 60079-10-1 Annex B.7" data-ua="Розраховує масову та об'ємну швидкості викиду на основі IEC 60079-10-1 Додаток B.7">Calculates mass and volumetric release rates based on IEC 60079-10-1 Annex B.7</p>
                </div>
            </div>
        </div>
        
        <!-- Outdoor Assessment Tab -->
        <div class="tab-content" id="outdoor-assessment">
            <div class="grid">
                <div class="card">
                    <h2 class="card-title" data-en="2. Outdoor Assessment" data-ua="2. Оцінка зовнішнього викиду">2. Outdoor Assessment</h2>
                    
                    <div class="input-group">
                        <label for="windSpeed" data-en="Wind Speed (U)" data-ua="Швидкість вітру (U)">Wind Speed (U)</label>
                        <input type="number" id="windSpeed" step="0.1" value="0.5">
                        <div class="unit">m/s</div>
                    </div>
                    <div class="explanation" data-en="Average wind speed at the location. Typical values: 0.5 m/s for calm conditions, 1-2 m/s for light breeze, 5+ m/s for windy conditions." data-ua="Середня швидкість вітру в місцевості. Типові значення: 0.5 м/с для спокійних умов, 1-2 м/с для легкого вітру, 5+ м/с для вітряних умов.">Average wind speed at the location. Typical values: 0.5 m/s for calm conditions, 1-2 m/s for light breeze, 5+ m/s for windy conditions.</div>
                
                    <div class="input-group">
                        <label for="obstruction" data-en="Obstruction Level" data-ua="Рівень перешкод">Obstruction Level</label>
                        <select id="obstruction">
                            <option value="unobstructed" data-en="Unobstructed" data-ua="Без перешкод">Unobstructed</option>
                            <option value="obstructed" data-en="Obstructed" data-ua="З перешкодами">Obstructed</option>
                        </select>
                        <div class="unit"></div>
                    </div>
                    <div class="explanation" data-en="Level of obstacles around the release point. 'Unobstructed' means open area with no significant barriers. 'Obstructed' means area with buildings, fences, or other structures that limit air movement." data-ua="Рівень перешкод навколо точки викиду. 'Без перешкод' означає відкриту територію без значних бар'єрів. 'З перешкодами' означає територію з будівлями, огорожами чи іншими спорудами, що обмежують рух повітря.">Level of obstacles around the release point. 'Unobstructed' means open area with no significant barriers. 'Obstructed' means area with buildings, fences, or other structures that limit air movement.</div>
                
                    <div class="input-group">
                        <label for="elevation" data-en="Elevation from Ground" data-ua="Висота над землею">Elevation from Ground</label>
                        <select id="elevation">
                            <option value="2" data-en="≤ 2 m" data-ua="≤ 2 м">≤ 2 m</option>
                            <option value="5" data-en="> 2 m up to 5 m" data-ua="> 2 м до 5 м">> 2 m up to 5 m</option>
                            <option value="above5" data-en="> 5 m" data-ua="> 5 м">> 5 m</option>
                        </select>
                        <div class="unit"></div>
                    </div>
                    <div class="explanation" data-en="Height of the release point above ground level. Wind speed typically increases with height." data-ua="Висота точки викиду над рівнем землі. Швидкість вітру зазвичай збільшується з висотою.">Height of the release point above ground level. Wind speed typically increases with height.</div>
                
                    <div class="formula">
                        <div class="formula-title" data-en="Dilution Level Calculation" data-ua="Розрахунок рівня розведення">Dilution Level Calculation</div>
                        <div data-en="Based on IEC 60079-10-1 Table C.1 and Figure C.1:" data-ua="На основі IEC 60079-10-1 Таблиця C.1 та Рисунок C.1:">Based on IEC 60079-10-1 Table C.1 and Figure C.1:</div>
                        <div data-en="Dilution level is determined by comparing the volumetric release characteristic (Q<sub>c</sub>) with the ventilation velocity (U)." data-ua="Рівень розведення визначається шляхом порівняння об'ємної характеристики викиду (Q<sub>c</sub>) зі швидкістю вентиляції (U).">Dilution level is determined by comparing the volumetric release characteristic (Q<sub>c</sub>) with the ventilation velocity (U).</div>
                        <div data-en="For heavier-than-air gases at elevation ≤ 2 m:" data-ua="Для газів важчих за повітря на висоті ≤ 2 м:">For heavier-than-air gases at elevation ≤ 2 m:</div>
                        <div>U = 0.3 m/s (unobstructed) or 0.15 m/s (obstructed)</div>
                        <div class="formula-explanation" data-en="Higher wind speeds and lower release rates result in better dilution (High level). Lower wind speeds and higher release rates result in poorer dilution (Low level)." data-ua="Більші швидкості вітру та менші швидкості викиду призводять до кращого розведення (Високий рівень). Менші швидкості вітру та більші швидкості викиду призводять до гіршого розведення (Низький рівень).">Higher wind speeds and lower release rates result in better dilution (High level). Lower wind speeds and higher release rates result in poorer dilution (Low level).</div>
                    </div>
                
                    <button class="btn" id="assessOutdoor" data-en="Assess Outdoor Conditions" data-ua="Оцінити умови на відкритому повітрі">Assess Outdoor Conditions</button>
                
                    <div class="results" id="outdoorResults">
                        <!-- Results will be populated here -->
                    </div>
                
                    <p class="hint" data-en="Determines ventilation availability and dilution level based on IEC 60079-10-1 Table C.1 and Figure C.1" data-ua="Визначає доступність вентиляції та рівень розведення на основі IEC 60079-10-1 Таблиця C.1 та Рисунок C.1">Determines ventilation availability and dilution level based on IEC 60079-10-1 Table C.1 and Figure C.1</p>
                </div>
            </div>
        </div>
        
        <!-- Indoor Assessment Tab -->
        <div class="tab-content" id="indoor-assessment">
            <div class="grid">
                <div class="card">
                    <h2 class="card-title" data-en="3. Indoor Assessment" data-ua="3. Оцінка внутрішнього викиду">3. Indoor Assessment</h2>
                    
                    <div class="type-a-opening">
                        <h4 data-en="Type A Opening (Ventilation Outlet) Assessment" data-ua="Оцінка отвору типу А (вентиляційний вихід)">Type A Opening (Ventilation Outlet) Assessment</h4>
                        <p data-en="According to IEC 60079-10-1 Article B.8, openings from enclosed spaces are classified as Type A openings (fixed ventilation outlets). The volumetric flow rate Q₂ of air/gas mixture leaving the room is used as the release characteristic for zone extent determination." data-ua="Згідно з IEC 60079-10-1 Стаття B.8, отвори з закритих просторів класифікуються як отвори типу А (фіксовані вентиляційні виходи). Об'ємна витрата Q₂ повітряно-газової суміші, що виходить з приміщення, використовується як характеристика викиду для визначення протяжності зони.">
                            According to IEC 60079-10-1 Article B.8, openings from enclosed spaces are classified as Type A openings (fixed ventilation outlets). The volumetric flow rate Q₂ of air/gas mixture leaving the room is used as the release characteristic for zone extent determination.
                        </p>
                    </div>
                    
                    <div class="conservative-mode-toggle">
                        <h4 data-en="Conservative Mode" data-ua="Консервативний режим">Conservative Mode</h4>
                        <div class="toggle-group">
                            <input type="checkbox" id="conservativeMode">
                            <label for="conservativeMode" data-en="Use Qc instead of Qg for background concentration (Xb)" data-ua="Використовувати Qc замість Qg для фонової концентрації (Xb)">Use Qc instead of Qg for background concentration (Xb)</label>
                        </div>
                        <div class="explanation" data-en="Use Qc in Xb assessment for maximum conservatism. May result in Xb ≫ 1. Not in line with basic Annex C methodology." data-ua="Використовувати Qc для оцінки Xb для максимальної консервативності. Може призвести до Xb ≫ 1. Не відповідає базовій методиці Додатка C.">Use Qc in Xb assessment for maximum conservatism. May result in Xb ≫ 1. Not in line with basic Annex C methodology.</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="a1" data-en="Lower Opening Area (A₁)" data-ua="Площа нижнього отвору (A₁)">Lower Opening Area (A₁)</label>
                        <input type="number" id="a1" step="0.001" value="0.05">
                        <div class="unit">m²</div>
                    </div>
                    <div class="explanation" data-en="Area of the lower ventilation opening (air intake). For natural ventilation, this is typically at ground level." data-ua="Площа нижнього вентиляційного отвору (повітрозабірник). Для природної вентиляції це зазвичай на рівні землі.">Area of the lower ventilation opening (air intake). For natural ventilation, this is typically at ground level.</div>
                
                    <div class="input-group">
                        <label for="a2" data-en="Upper Opening Area (A₂)" data-ua="Площа верхнього отвору (A₂)">Upper Opening Area (A₂)</label>
                        <input type="number" id="a2" step="0.001" value="0.05">
                        <div class="unit">m²</div>
                    </div>
                    <div class="explanation" data-en="Area of the upper ventilation opening (air exhaust). For natural ventilation, this is typically near the ceiling." data-ua="Площа верхнього вентиляційного отвору (витяжка). Для природної вентиляції це зазвичай біля стелі.">Area of the upper ventilation opening (air exhaust). For natural ventilation, this is typically near the ceiling.</div>
                
                    <div class="input-group">
                        <label for="roomVolume" data-en="Room Volume (V₀)" data-ua="Об'єм приміщення (V₀)">Room Volume (V₀)</label>
                        <input type="number" id="roomVolume" step="0.1" value="50.0">
                        <div class="unit">m³</div>
                    </div>
                    <div class="explanation" data-en="Total volume of the enclosed space. Calculate as length × width × height." data-ua="Загальний об'єм закритого простору. Розрахуйте як довжина × ширина × висота.">Total volume of the enclosed space. Calculate as length × width × height.</div>
                
                    <div class="input-group">
                        <label for="windSpeedEnclosed" data-en="Wind Speed (U)" data-ua="Швидкість вітру (U)">Wind Speed (U)</label>
                        <input type="number" id="windSpeedEnclosed" step="0.1" value="2.0">
                        <div class="unit">m/s</div>
                    </div>
                    <div class="explanation" data-en="Wind speed outside the enclosed space that drives natural ventilation." data-ua="Швидкість вітру зовні закритого простору, що забезпечує природну вентиляцію.">Wind speed outside the enclosed space that drives natural ventilation.</div>
                
                    <div class="input-group">
                        <label for="deltaCp" data-en="Pressure Coefficient (ΔCₚ)" data-ua="Коефіцієнт тиску (ΔCₚ)">Pressure Coefficient (ΔCₚ)</label>
                        <input type="number" id="deltaCp" step="0.01" value="0.5">
                        <div class="unit">—</div>
                    </div>
                    <div class="explanation" data-en="Difference in pressure coefficients between windward and leeward sides. Typical values: 0.1 for sheltered buildings, 0.5 for average conditions, 1.0 for exposed buildings." data-ua="Різниця коефіцієнтів тиску між навітряною та підвітряною сторонами. Типові значення: 0.1 для захищених будівель, 0.5 для середніх умов, 1.0 для відкритих будівель.">Difference in pressure coefficients between windward and leeward sides. Typical values: 0.1 for sheltered buildings, 0.5 for average conditions, 1.0 for exposed buildings.</div>
                
                    <div class="input-group">
                        <label for="inefficiency" data-en="Ventilation Inefficiency (f)" data-ua="Неефективність вентиляції (f)">Ventilation Inefficiency (f)</label>
                        <input type="number" id="inefficiency" step="0.1" value="3.0">
                        <div class="unit">—</div>
                    </div>
                    <div class="explanation" data-en="Factor accounting for non-ideal mixing of air. Typical values: 1.5 for mildly inefficient mixing, 3.0 for average conditions, 5.0 for very inefficient mixing." data-ua="Коефіцієнт, що враховує неідеальне перемішування повітря. Типові значення: 1.5 для слабко неефективного перемішування, 3.0 для середніх умов, 5.0 для дуже неефективного перемішування.">Factor accounting for non-ideal mixing of air. Typical values: 1.5 for mildly inefficient mixing, 3.0 for average conditions, 5.0 for very inefficient mixing.</div>
                
                    <div class="formula">
                        <div class="formula-title" data-en="Ventilation and Background Concentration Formulas" data-ua="Формули вентиляції та фонової концентрації">Ventilation and Background Concentration Formulas</div>
                        <div data-en="Equivalent area:" data-ua="Еквівалентна площа:">Equivalent area:</div>
                        <div>A<sub>e</sub> = (A₁ × A₂) / √(A₁² + A₂²)</div>
                        <div data-en="Air flow rate:" data-ua="Витрата повітря:">Air flow rate:</div>
                        <div>Q<sub>a</sub> = C<sub>d</sub> × A<sub>e</sub> × U × √(ΔC<sub>p</sub>)</div>
                        <div data-en="Air change frequency:" data-ua="Частота повітрообміну:">Air change frequency:</div>
                        <div>C = Q<sub>a</sub> / V₀</div>
                        <div data-en="Background concentration (Standard):" data-ua="Фонова концентрація (Стандартна):">Background concentration (Standard):</div>
                        <div>X<sub>b</sub> = (f × Q<sub>g</sub>) / Q<sub>a</sub></div>
                        <div data-en="Background concentration (Conservative):" data-ua="Фонова концентрація (Консервативна):">Background concentration (Conservative):</div>
                        <div>X<sub>b</sub> = (f × Q<sub>c</sub>) / Q<sub>a</sub></div>
                        <div data-en="Critical concentration:" data-ua="Критична концентрація:">Critical concentration:</div>
                        <div>X<sub>crit</sub> = 0.25 × LFL</div>
                        <div class="formula-explanation" data-en="Where: A₁, A₂ - ventilation opening areas, C<sub>d</sub> - discharge coefficient (typically 0.6), U - wind speed, ΔC<sub>p</sub> - pressure coefficient difference, V₀ - room volume, f - ventilation inefficiency factor, Q<sub>g</sub> - volumetric gas inflow, Q<sub>c</sub> - volumetric release characteristic" data-ua="Де: A₁, A₂ - площі вентиляційних отворів, C<sub>d</sub> - коефіцієнт витрати (зазвичай 0.6), U - швидкість вітру, ΔC<sub>p</sub> - різниця коефіцієнтів тиску, V₀ - об'єм приміщення, f - коефіцієнт неефективності вентиляції, Q<sub>g</sub> - об'ємний приток газу, Q<sub>c</sub> - характеристика об'ємного викиду">Where: A₁, A₂ - ventilation opening areas, C<sub>d</sub> - discharge coefficient (typically 0.6), U - wind speed, ΔC<sub>p</sub> - pressure coefficient difference, V₀ - room volume, f - ventilation inefficiency factor, Q<sub>g</sub> - volumetric gas inflow, Q<sub>c</sub> - volumetric release characteristic</div>
                    </div>
                
                    <button class="btn" id="assessEnclosed" data-en="Assess Indoor Space" data-ua="Оцінити внутрішній простір">Assess Indoor Space</button>
                
                    <div class="results" id="enclosedResults">
                        <!-- Results will be populated here -->
                    </div>
                
                    <p class="hint" data-en="Calculates ventilation parameters and background concentration based on IEC 60079-10-1 Annex C" data-ua="Розраховує параметри вентиляції та фонову концентрацію на основі IEC 60079-10-1 Додаток C">Calculates ventilation parameters and background concentration based on IEC 60079-10-1 Annex C</p>
                </div>
            </div>
        </div>
        
        <!-- Standards Compliance Tab -->
        <div class="tab-content" id="standards-check">
            <div class="grid">
                <div class="card">
                    <h2 class="card-title" data-en="4. Standards Compliance Check" data-ua="4. Перевірка відповідності стандартам">4. Standards Compliance Check</h2>
                    
                    <div class="input-group">
                        <label for="floorArea" data-en="Floor Area" data-ua="Площа підлоги">Floor Area</label>
                        <input type="number" id="floorArea" step="0.1" value="25.0">
                        <div class="unit">m²</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="openingsSameWall" data-en="Openings Location" data-ua="Розташування отворів">Openings Location</label>
                        <select id="openingsSameWall">
                            <option value="false" data-en="Different walls" data-ua="Різні стіни">Different walls</option>
                            <option value="true" data-en="Same wall" data-ua="Одна стіна">Same wall</option>
                        </select>
                        <div class="unit"></div>
                    </div>
                    
                    <button class="btn" id="checkStandards" data-en="Check Standards Compliance" data-ua="Перевірити відповідність стандартам">Check Standards Compliance</button>
                    
                    <div class="results" id="standardsResults">
                        <!-- Results will be populated here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Zone Classification Tab -->
        <div class="tab-content" id="classification">
            <div class="grid">
                <div class="card">
                    <h2 class="card-title" data-en="5. Hazardous Area Classification" data-ua="5. Класифікація небезпечної зони">5. Hazardous Area Classification</h2>
                    
                    <div class="type-a-opening indoor-only">
                        <h4 data-en="Type A Opening Zone Calculation" data-ua="Розрахунок зони для отвору типу А">Type A Opening Zone Calculation</h4>
                        <p data-en="For Type A openings (ventilation outlets), use Q₂ (air/gas mixture outflow rate) as the release characteristic for zone extent determination from Figure D.1." data-ua="Для отворів типу А (вентиляційні виходи) використовуйте Q₂ (швидкість виходу повітряно-газової суміші) як характеристику викиду для визначення протяжності зони з Рисунка D.1.">
                            For Type A openings (ventilation outlets), use Q₂ (air/gas mixture outflow rate) as the release characteristic for zone extent determination from Figure D.1.
                        </p>
                    </div>
                    
                    <div class="input-group">
                        <label for="releaseGrade" data-en="Grade of Release" data-ua="Ступінь викиду">Grade of Release</label>
                        <select id="releaseGrade">
                            <option value="secondary" data-en="Secondary" data-ua="Вторинний">Secondary</option>
                            <option value="primary" data-en="Primary" data-ua="Первинний">Primary</option>
                            <option value="continuous" data-en="Continuous" data-ua="Безперервний">Continuous</option>
                        </select>
                        <div class="unit"></div>
                    </div>
                    <div class="explanation" data-en="Frequency of release: Continuous (expected regularly), Primary (likely to occur periodically), Secondary (unlikely to occur in normal operation)." data-ua="Частота викиду: Безперервний (очікується регулярно), Первинний (ймовірно періодично), Вторинний (малоймовірно в нормальному режимі роботи).">Frequency of release: Continuous (expected regularly), Primary (likely to occur periodically), Secondary (unlikely to occur in normal operation).</div>
                
                    <div class="input-group">
                        <label for="jetType" data-en="Jet Type" data-ua="Тип струменя">Jet Type</label>
                        <select id="jetType">
                            <option value="auto" data-en="Auto-detect" data-ua="Автовизначення">Auto-detect</option>
                            <option value="unimpeded" data-en="Unimpeded Jet" data-ua="Неперешкоджений струмінь">Unimpeded Jet</option>
                            <option value="diffusive" data-en="Diffusive Jet" data-ua="Дифузійний струмінь">Diffusive Jet</option>
                            <option value="heavy" data-en="Heavy Gas" data-ua="Важкий газ">Heavy Gas</option>
                        </select>
                        <div class="unit"></div>
                    </div>
                    <div class="explanation" data-en="Type of gas release: Unimpeded Jet (high velocity, freely discharged), Diffusive Jet (low velocity or obstructed), Heavy Gas (liquid release forming pools). Auto-detect uses: Choked flow/high pressure = Unimpeded Jet, Low pressure = Diffusive Jet, Heavy gas density = Heavy Gas" data-ua="Тип викиду газу: Неперешкоджений струмінь (висока швидкість, вільний викид), Дифузійний струмінь (низька швидкість або перешкоджений), Важкий газ (викид рідини з утворенням луж). Автовизначення використовує: Перекритий потік/високий тиск = Неперешкоджений струмінь, Низький тиск = Дифузійний струмінь, Висока щільність газу = Важкий газ">Type of gas release: Unimpeded Jet (high velocity, freely discharged), Diffusive Jet (low velocity or obstructed), Heavy Gas (liquid release forming pools). Auto-detect uses: Choked flow/high pressure = Unimpeded Jet, Low pressure = Diffusive Jet, Heavy gas density = Heavy Gas</div>
                    
                    <!-- Zone Extent Calculation based on Figure D.1 -->
                    <div class="input-group">
                        <label for="qcForZone" data-en="Qc for Zone Calculation" data-ua="Qc для розрахунку зони">Qc for Zone Calculation</label>
                        <input type="number" id="qcForZone" step="0.001" value="0.0" readonly>
                        <div class="unit">m³/s</div>
                    </div>
                    <div class="explanation" data-en="Volumetric release characteristic (Qc) used for zone extent determination from Figure D.1." data-ua="Характеристика об'ємного викиду (Qc), що використовується для визначення протяжності зони з Рисунка D.1.">Volumetric release characteristic (Qc) used for zone extent determination from Figure D.1.</div>
                    
                    <div class="input-group">
                        <label for="zoneExtentManual" data-en="Zone Extent from Figure D.1" data-ua="Протяжність зони з Рисунка D.1">Zone Extent from Figure D.1</label>
                        <input type="number" id="zoneExtentManual" step="0.1" value="1.0">
                        <div class="unit">m</div>
                    </div>
                    <div class="explanation" data-en="Zone extent determined from Figure D.1 based on Qc value." data-ua="Протяжність зони, визначена з Рисунка D.1 на основі значення Qc.">Zone extent determined from Figure D.1 based on Qc value.</div>
                
                    <div class="formula">
                        <div class="formula-title" data-en="Zone Extent Determination" data-ua="Визначення протяжності зони">Zone Extent Determination</div>
                        <div data-en="Based on IEC 60079-10-1 Figure D.1:" data-ua="На основі IEC 60079-10-1 Рисунок D.1:">Based on IEC 60079-10-1 Figure D.1:</div>
                        <div data-en="1. Calculate Qc = ṁ / (ρ<sub>g</sub> × LFL) [m³/s]" data-ua="1. Розрахувати Qc = ṁ / (ρ<sub>g</sub> × LFL) [м³/с]">1. Calculate Qc = ṁ / (ρ<sub>g</sub> × LFL) [m³/s]</div>
                        <div data-en="2. Determine zone extent from Figure D.1 based on Qc" data-ua="2. Визначити протяжність зони з Рисунка D.1 на основі Qc">2. Determine zone extent from Figure D.1 based on Qc</div>
                        <div data-en="3. Apply 25% LFL rule for indoor spaces" data-ua="3. Застосувати правило 25% LFL для внутрішніх приміщень">3. Apply 25% LFL rule for indoor spaces</div>
                        <div class="formula-explanation" data-en="Note: Use Figure D.1 for accurate zone extent determination. For Type A openings, use Q₂ as release characteristic." data-ua="Примітка: Використовуйте Рисунок D.1 для точного визначення протяжності зони. Для отворів типу А використовуйте Q₂ як характеристику викиду.">Note: Use Figure D.1 for accurate zone extent determination. For Type A openings, use Q₂ as release characteristic.</div>
                    </div>
                
                    <button class="btn" id="classifyArea" data-en="Classify Hazardous Area" data-ua="Класифікувати небезпечну зону">Classify Hazardous Area</button>
                
                    <div class="results" id="classificationResults">
                        <!-- Results will be populated here -->
                    </div>
                
                    <p class="hint" data-en="Determines zone type and extent based on IEC 60079-10-1 Table D.1 and Figure D.1" data-ua="Визначає тип зони та її протяжність на основі IEC 60079-10-1 Таблиця D.1 та Рисунок D.1">Determines zone type and extent based on IEC 60079-10-1 Table D.1 and Figure D.1</p>
                </div>
            </div>
            
            <!-- HAC Assessment Summary -->
            <div class="summary">
                <h2 class="summary-title" data-en="HAC Assessment Summary" data-ua="Підсумок оцінки HAC">HAC Assessment Summary</h2>
                <div class="summary-grid" id="summaryResults">
                    <div class="summary-item">
                        <h3 data-en="Scenario" data-ua="Сценарій">Scenario</h3>
                        <p id="summaryScenario">—</p>
                    </div>
                    <div class="summary-item">
                        <h3 data-en="Release Characteristic" data-ua="Характеристика викиду">Release Characteristic</h3>
                        <p id="summaryQc">— m³/s</p>
                    </div>
                    <div class="summary-item indoor-only">
                        <h3 data-en="Type A Opening Q₂" data-ua="Отвір типу А Q₂">Type A Opening Q₂</h3>
                        <p id="summaryQ2">— m³/s</p>
                    </div>
                    <div class="summary-item">
                        <h3 data-en="Ventilation Availability" data-ua="Доступність вентиляції">Ventilation Availability</h3>
                        <p id="summaryVentilation">—</p>
                    </div>
                    <div class="summary-item">
                        <h3 data-en="Dilution Level" data-ua="Рівень розведення">Dilution Level</h3>
                        <p id="summaryDilution">—</p>
                    </div>
                    <div class="summary-item">
                        <h3 data-en="Hazardous Zone" data-ua="Небезпечна зона">Hazardous Zone</h3>
                        <p id="summaryZone">—</p>
                    </div>
                    <div class="summary-item">
                        <h3 data-en="Zone Extent" data-ua="Протяжність зони">Zone Extent</h3>
                        <p id="summaryExtent">— m</p>
                    </div>
                    <div class="summary-item indoor-only">
                        <h3 data-en="Background Concentration" data-ua="Фонова концентрація">Background Concentration</h3>
                        <p id="summaryBackground">—</p>
                    </div>
                </div>
                
                <button class="btn secondary" id="generateReport" style="margin-top: 20px;" data-en="Generate Detailed Report" data-ua="Створити детальний звіт">Generate Detailed Report</button>
                <button class="btn secondary" id="generateDetailedReport" style="margin-top: 10px;" data-en="Download Full Report" data-ua="Завантажити повний звіт">Download Full Report</button>
            </div>
        </div>
        
        <div class="footer">
            <p data-en="This calculator follows IEC 60079-10-1:2020, EN 12186:2014, IGEM TD/13 Ed.3, and BS 5925:1991 standards" data-ua="Цей калькулятор відповідає стандартам IEC 60079-10-1:2020, EN 12186:2014, IGEM TD/13 Ed.3 та BS 5925:1991">This calculator follows IEC 60079-10-1:2020, EN 12186:2014, IGEM TD/13 Ed.3, and BS 5925:1991 standards</p>
            <p data-en="All results must be verified by a competent engineer before implementation" data-ua="Усі результати повинні бути перевірені компетентним інженером перед впровадженням">All results must be verified by a competent engineer before implementation</p>
        </div>
    </div>

    <script>
        // Global variables to store calculation logs
        let calculationLogs = {
            scenario: 'outdoor',
            releaseRate: {},
            outdoorAssessment: {},
            indoorAssessment: {},
            zoneClassification: {},
            standardsCheck: {},
            typeAOpening: {},
            conservativeMode: false,
            calculatorVersion: '2.1',
            calculationDateTime: null,
            calculationSteps: []
        };

        // Функция для форматирования чисел
        function formatNumber(num, decimals = 6) {
            if (num === null || num === undefined || isNaN(num)) return '—';
            if (num === 0) return '0';
            
            // Для очень маленьких чисел используем научную нотацию
            if (Math.abs(num) < 0.001) {
                return num.toExponential(3);
            }
            
            // Для обычных чисел используем фиксированное количество знаков
            return Number(num.toFixed(decimals)).toString();
        }

        // Функция для добавления записи в лог
        function addCalculationLog(step, description, value = null) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = {
                timestamp,
                step,
                description,
                value
            };
            calculationLogs.calculationSteps.push(logEntry);
            
            // Обновление UI лога
            const logContainer = document.getElementById('releaseCalculationLog');
            if (logContainer) {
                const logElement = document.createElement('div');
                logElement.className = 'log-entry';
                logElement.innerHTML = `<span class="log-time">[${timestamp}]</span> ${step}: ${description} ${value !== null ? `= ${formatNumber(value)}` : ''}`;
                logContainer.appendChild(logElement);
                logContainer.scrollTop = logContainer.scrollHeight;
            }
        }

        // Функция для переключения языка
        function updateLanguage(lang) {
            // Обновляем все элементы с атрибутами data-en и data-ua
            document.querySelectorAll('[data-en], [data-ua]').forEach(element => {
                if (element.hasAttribute(`data-${lang}`)) {
                    const text = element.getAttribute(`data-${lang}`);
                    if (element.tagName === 'INPUT' || element.tagName === 'SELECT') {
                        if (element.placeholder !== undefined) {
                            element.placeholder = text;
                        }
                    } else {
                        element.textContent = text;
                    }
                }
            });
            
            // Обновляем активные кнопки языка
            document.querySelectorAll('.language-btn').forEach(btn => {
                if (btn.getAttribute('data-lang') === lang) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            console.log('Language updated to:', lang);
        }

        // Функция для проверки валидности входных данных
        function validateInputs() {
            const errors = [];
            
            // Проверка свойств газа
            const lfl = parseFloat(document.getElementById('lfl').value);
            if (lfl <= 0 || lfl >= 0.1) {
                errors.push('LFL must be between 0 and 0.1 vol/vol');
            }
            
            // Проверка параметров вентиляции (для indoor)
            if (calculationLogs.scenario === 'indoor') {
                const a1 = parseFloat(document.getElementById('a1').value);
                const a2 = parseFloat(document.getElementById('a2').value);
                const roomVolume = parseFloat(document.getElementById('roomVolume').value);
                const windSpeed = parseFloat(document.getElementById('windSpeedEnclosed').value);
                const deltaCp = parseFloat(document.getElementById('deltaCp').value);
                const inefficiency = parseFloat(document.getElementById('inefficiency').value);
                
                if (a1 <= 0 || a2 <= 0) errors.push('Ventilation opening areas must be > 0');
                if (roomVolume <= 0) errors.push('Room volume must be > 0');
                if (windSpeed <= 0) errors.push('Wind speed must be > 0');
                if (deltaCp <= 0) errors.push('Pressure coefficient must be > 0');
                if (inefficiency < 1 || inefficiency > 10) errors.push('Ventilation inefficiency must be between 1 and 10');
                
                // Проверка маленьких помещений
                if (roomVolume < 5) {
                    errors.push('Warning: Room volume < 5 m³ may lead to unrealistic results');
                }
                
                // Проверка низкой скорости ветра
                if (windSpeed < 0.1) {
                    errors.push('Warning: Wind speed < 0.1 m/s may indicate inadequate ventilation');
                }
            }
            
            return errors;
        }

        // Основные функции калькулятора
        function calculateReleaseRate() {
            console.log('Calculate Release Rate called');
            addCalculationLog('START', 'Release rate calculation started');
            
            // Собираем данные
            const molarMass = parseFloat(document.getElementById('molarMass').value);
            const gamma = parseFloat(document.getElementById('gamma').value);
            const lfl = parseFloat(document.getElementById('lfl').value);
            const temp = parseFloat(document.getElementById('temp').value);
            const holeSize = parseFloat(document.getElementById('holeSize').value) * 1e-6; // convert mm² to m²
            const pressure = parseFloat(document.getElementById('pressure').value);
            const pressureType = document.querySelector('input[name="pressureType"]:checked').value;
            const cd = parseFloat(document.getElementById('cd').value);
            
            addCalculationLog('INPUT', 'Gas properties', {molarMass, gamma, lfl, temp, holeSize, pressure, pressureType, cd});
            
            // Константы
            const R = 8.314; // универсальная газовая постоянная J/(mol·K)
            const atmosphericPressure = 1.01325; // bar
            
            // Расчет абсолютного давления
            let p0, pd;
            if (pressureType === 'gauge') {
                p0 = pressure + atmosphericPressure;
                pd = atmosphericPressure;
            } else {
                p0 = pressure;
                pd = atmosphericPressure;
            }
            
            const p0_pa = p0 * 1e5; // convert bar to Pa
            const pd_pa = pd * 1e5;
            const Z = 1; // коэффициент сжимаемости (упрощенно)
            const R_specific = R / molarMass; // удельная газовая постоянная
            
            addCalculationLog('PRESSURE', 'Absolute pressures calculated', {p0, pd});
            
            // Проверка на критический поток
            const p_critical = p0 * Math.pow(2/(gamma+1), gamma/(gamma-1));
            const isChoked = p_critical > pd;
            
            addCalculationLog('FLOW_CHECK', `Critical pressure ratio: ${p_critical.toFixed(3)} bar`, isChoked ? 'CHOKED' : 'SUBSONIC');
            
            let massFlowRate;
            if (isChoked) {
                // Критический поток с исправленной формулой
                const criticalFactor = Math.pow(2/(gamma+1), (gamma+1)/(2*(gamma-1)));
                massFlowRate = cd * holeSize * p0_pa * Math.sqrt(gamma/(Z * R_specific * temp)) * criticalFactor;
                addCalculationLog('CHOKED_FLOW', 'Choked flow calculation', massFlowRate);
            } else {
                // Дозвуковой поток с правильными давлениями
                const pressureRatio = pd / p0;
                const flowFactor = Math.sqrt((2*gamma/((gamma-1)*R_specific*temp)) * 
                    (Math.pow(pressureRatio, 2/gamma) - Math.pow(pressureRatio, (gamma+1)/gamma)));
                massFlowRate = cd * holeSize * p0_pa * flowFactor;
                addCalculationLog('SUBSONIC_FLOW', 'Subsonic flow calculation', massFlowRate);
            }
            
            // Расчет плотности газа при атмосферном давлении
            const gasDensity_atmospheric = (atmosphericPressure * 1e5 * molarMass) / (R * temp);
            
            // Расчет Qg и Qc
            const qg = massFlowRate / gasDensity_atmospheric;
            const qc = massFlowRate / (gasDensity_atmospheric * lfl);
            
            addCalculationLog('RESULTS', 'Volumetric flows calculated', {qg, qc});
            
            // Сохраняем результаты
            calculationLogs.releaseRate = {
                massFlowRate: massFlowRate,
                massFlowRateKgH: massFlowRate * 3600,
                qg: qg,
                qgM3H: qg * 3600,
                qc: qc,
                qcM3H: qc * 3600,
                isChoked: isChoked,
                gasDensity: gasDensity_atmospheric,
                pressureRatio: p0 / pd
            };
            
            // Обновляем UI
            updateReleaseResults();
            updateJetTypeFromCalculation();
            addCalculationLog('COMPLETE', 'Release rate calculation completed');
            
            return calculationLogs.releaseRate;
        }

        function updateReleaseResults() {
            const resultsDiv = document.getElementById('releaseResults');
            const data = calculationLogs.releaseRate;
            
            if (!data.massFlowRate) {
                resultsDiv.innerHTML = '<div class="result-item">No calculation performed</div>';
                return;
            }
            
            resultsDiv.innerHTML = `
                <div class="result-item">
                    <span>Mass Flow Rate:</span>
                    <span class="result-value">${formatNumber(data.massFlowRate)} kg/s</span>
                </div>
                <div class="result-item">
                    <span>Mass Flow Rate:</span>
                    <span class="result-value">${formatNumber(data.massFlowRateKgH)} kg/h</span>
                </div>
                <div class="result-item">
                    <span>Volumetric Gas Inflow (Q<sub>g</sub>):</span>
                    <span class="result-value">${formatNumber(data.qg)} m³/s</span>
                </div>
                <div class="result-item">
                    <span>Volumetric Gas Inflow (Q<sub>g</sub>):</span>
                    <span class="result-value">${formatNumber(data.qgM3H)} m³/h</span>
                </div>
                <div class="result-item">
                    <span>Release Characteristic (Q<sub>c</sub>):</span>
                    <span class="result-value">${formatNumber(data.qc)} m³/s</span>
                </div>
                <div class="result-item">
                    <span>Release Characteristic (Q<sub>c</sub>):</span>
                    <span class="result-value">${formatNumber(data.qcM3H)} m³/h</span>
                </div>
                <div class="result-item">
                    <span>Flow Type:</span>
                    <span class="result-value">${data.isChoked ? 'Choked' : 'Subsonic'}</span>
                </div>
                <div class="result-details">
                    Q<sub>g</sub> = ṁ/ρ<sub>g</sub> (for X<sub>b</sub> calculation), Q<sub>c</sub> = ṁ/(ρ<sub>g</sub>×LFL) (for zone extent)
                </div>
            `;
        }

        function assessOutdoorConditions() {
            console.log('Assess Outdoor Conditions called');
            
            const windSpeed = parseFloat(document.getElementById('windSpeed').value);
            const obstruction = document.getElementById('obstruction').value;
            const elevation = document.getElementById('elevation').value;
            
            // Определение уровня вентиляции
            let ventilationAvailability, dilutionLevel;
            
            if (windSpeed >= 0.5) {
                ventilationAvailability = 'Good';
                dilutionLevel = 'High';
            } else if (windSpeed >= 0.25) {
                ventilationAvailability = 'Fair';
                dilutionLevel = 'Medium';
            } else {
                ventilationAvailability = 'Poor';
                dilutionLevel = 'Low';
            }
            
            // Сохраняем результаты
            calculationLogs.outdoorAssessment = {
                windSpeed: windSpeed,
                obstruction: obstruction,
                elevation: elevation,
                ventilationAvailability: ventilationAvailability,
                dilutionLevel: dilutionLevel
            };
            
            // Обновляем UI
            updateOutdoorResults();
            
            return calculationLogs.outdoorAssessment;
        }

        function updateOutdoorResults() {
            const resultsDiv = document.getElementById('outdoorResults');
            const data = calculationLogs.outdoorAssessment;
            
            if (!data.ventilationAvailability) {
                resultsDiv.innerHTML = '<div class="result-item">No assessment performed</div>';
                return;
            }
            
            let availabilityClass = 'pill ok';
            if (data.ventilationAvailability === 'Fair') availabilityClass = 'pill warn';
            if (data.ventilationAvailability === 'Poor') availabilityClass = 'pill bad';
            
            let dilutionClass = 'pill ok';
            if (data.dilutionLevel === 'Medium') dilutionClass = 'pill warn';
            if (data.dilutionLevel === 'Low') dilutionClass = 'pill bad';
            
            resultsDiv.innerHTML = `
                <div class="result-item">
                    <span>Wind Speed:</span>
                    <span class="result-value">${formatNumber(data.windSpeed, 2)} m/s</span>
                </div>
                <div class="result-item">
                    <span>Obstruction Level:</span>
                    <span class="result-value">${data.obstruction}</span>
                </div>
                <div class="result-item">
                    <span>Elevation:</span>
                    <span class="result-value">${data.elevation} m</span>
                </div>
                <div class="result-item">
                    <span>Ventilation Availability:</span>
                    <span class="result-value ${availabilityClass}">${data.ventilationAvailability}</span>
                </div>
                <div class="result-item">
                    <span>Dilution Level:</span>
                    <span class="result-value ${dilutionClass}">${data.dilutionLevel}</span>
                </div>
            `;
        }

        function assessEnclosedSpace() {
            console.log('Assess Enclosed Space called');
            
            // Валидация входных данных
            const validationErrors = validateInputs();
            if (validationErrors.length > 0) {
                alert('Validation errors:\n' + validationErrors.join('\n'));
                return;
            }
            
            const a1 = parseFloat(document.getElementById('a1').value);
            const a2 = parseFloat(document.getElementById('a2').value);
            const roomVolume = parseFloat(document.getElementById('roomVolume').value);
            const windSpeed = parseFloat(document.getElementById('windSpeedEnclosed').value);
            const deltaCp = parseFloat(document.getElementById('deltaCp').value);
            const inefficiency = parseFloat(document.getElementById('inefficiency').value);
            const conservativeMode = document.getElementById('conservativeMode').checked;
            
            calculationLogs.conservativeMode = conservativeMode;
            
            // Расчеты для закрытого пространства
            const equivalentArea = (a1 * a2) / Math.sqrt(a1*a1 + a2*a2);
            const airFlowRate = 0.6 * equivalentArea * windSpeed * Math.sqrt(deltaCp);
            const airChangeFrequency = airFlowRate / roomVolume;
            
            // Расчет Q2 для Type A Opening
            const q2 = airFlowRate;
            
            // Расчет фоновой концентрации в зависимости от режима
            let xb, xbNote;
            if (conservativeMode) {
                // Консервативный режим: используем Qc
                xb = (inefficiency * calculationLogs.releaseRate.qc) / airFlowRate;
                xbNote = 'Conservative mode: Xb estimated with Qc';
            } else {
                // Стандартный режим: используем Qg
                xb = (inefficiency * calculationLogs.releaseRate.qg) / airFlowRate;
                xbNote = 'Standard mode: Xb estimated with Qg';
            }
            
            // Расчет критической концентрации
            const lfl = parseFloat(document.getElementById('lfl').value);
            const xCrit = 0.25 * lfl;
            
            // Правило 25% LFL - автоматическое снижение степени разбавления
            let dilutionLevel = 'High';
            if (xb >= xCrit) {
                dilutionLevel = 'Low';
                xbNote += ' (25% LFL rule applied: Low dilution)';
            }
            
            // Проверка на нефизичные значения
            let xbWarning = '';
            if (xb > 1) {
                xbWarning = 'Non-physical Xb > 1. Check inputs/assumptions.';
            }
            
            // Сохраняем результаты
            calculationLogs.indoorAssessment = {
                equivalentArea: equivalentArea,
                airFlowRate: airFlowRate,
                airChangeFrequency: airChangeFrequency,
                q2: q2,
                xb: xb,
                xbNote: xbNote,
                xbWarning: xbWarning,
                xCrit: xCrit,
                dilutionLevel: dilutionLevel,
                conservativeMode: conservativeMode
            };
            
            calculationLogs.typeAOpening = {
                q2: q2
            };
            
            // Обновляем UI
            updateEnclosedResults();
            
            return calculationLogs.indoorAssessment;
        }

        function updateEnclosedResults() {
            const resultsDiv = document.getElementById('enclosedResults');
            const data = calculationLogs.indoorAssessment;
            
            if (!data.airFlowRate) {
                resultsDiv.innerHTML = '<div class="result-item">No assessment performed</div>';
                return;
            }
            
            let warningHTML = '';
            if (data.xbWarning) {
                warningHTML = `<div class="warning-banner">${data.xbWarning}</div>`;
            }
            
            if (data.conservativeMode) {
                warningHTML += `<div class="info-banner">Conservative mode: Xb estimated with Qc; results are intentionally conservative</div>`;
            }
            
            // Форматирование кратности воздухообмена
            const airChangePerHour = data.airChangeFrequency * 3600;
            let airChangeDisplay = `${formatNumber(data.airChangeFrequency)} s⁻¹`;
            if (airChangePerHour >= 0.001) {
                airChangeDisplay += ` (${formatNumber(airChangePerHour)} h⁻¹)`;
            } else {
                airChangeDisplay += ` (${airChangePerHour.toExponential(3)} h⁻¹)`;
            }
            
            // Расчет процента от LFL
            const lfl = parseFloat(document.getElementById('lfl').value);
            const xbPercentLFL = (data.xb / lfl) * 100;
            const xCritPercentLFL = (data.xCrit / lfl) * 100;
            
            let dilutionClass = 'pill ok';
            if (data.dilutionLevel === 'Medium') dilutionClass = 'pill warn';
            if (data.dilutionLevel === 'Low') dilutionClass = 'pill bad';
            
            resultsDiv.innerHTML = `
                ${warningHTML}
                <div class="result-item">
                    <span>Equivalent Area (A<sub>e</sub>):</span>
                    <span class="result-value">${formatNumber(data.equivalentArea)} m²</span>
                </div>
                <div class="result-item">
                    <span>Air Flow Rate (Q<sub>a</sub>):</span>
                    <span class="result-value">${formatNumber(data.airFlowRate)} m³/s</span>
                </div>
                <div class="result-item">
                    <span>Air Change Frequency (C):</span>
                    <span class="result-value">${airChangeDisplay}</span>
                </div>
                <div class="result-item">
                    <span>Type A Opening Q₂:</span>
                    <span class="result-value">${formatNumber(data.q2)} m³/s</span>
                </div>
                <div class="result-item">
                    <span>Background Concentration (X<sub>b</sub>):</span>
                    <span class="result-value">${formatNumber(data.xb)}</span>
                </div>
                <div class="result-item">
                    <span>X<sub>b</sub> relative to LFL:</span>
                    <span class="result-value">${formatNumber(xbPercentLFL, 2)}%</span>
                </div>
                <div class="result-item">
                    <span>Critical Concentration (X<sub>crit</sub>):</span>
                    <span class="result-value">${formatNumber(data.xCrit)} (= ${formatNumber(xCritPercentLFL, 1)}% LFL)</span>
                </div>
                <div class="result-item">
                    <span>Dilution Level:</span>
                    <span class="result-value ${dilutionClass}">${data.dilutionLevel}</span>
                </div>
                <div class="result-details">
                    ${data.xbNote}
                </div>
            `;
        }

        function checkVentilationStandardsCompliance() {
            console.log('Check Standards Compliance called');
            
            const floorArea = parseFloat(document.getElementById('floorArea').value);
            const openingsSameWall = document.getElementById('openingsSameWall').value === 'true';
            const a1 = parseFloat(document.getElementById('a1').value);
            const a2 = parseFloat(document.getElementById('a2').value);
            
            const totalVentArea = a1 + a2;
            const ventAreaPercentage = totalVentArea / floorArea;
            
            // Проверка EN 12186 (1% minimum)
            const en12186Min = 0.01;
            const en12186Pass = ventAreaPercentage >= en12186Min;
            
            // Проверка IGEM TD/13 (2% или 3% если на одной стене)
            const igemMin = openingsSameWall ? 0.03 : 0.02;
            const igemPass = ventAreaPercentage >= igemMin;
            
            // Сохраняем результаты
            calculationLogs.standardsCheck = {
                floorArea: floorArea,
                totalVentArea: totalVentArea,
                ventAreaPercentage: ventAreaPercentage,
                openingsSameWall: openingsSameWall,
                en12186: {
                    minPercentage: en12186Min,
                    pass: en12186Pass,
                    message: en12186Pass ? 
                        `PASS: Meets EN 12186 (≥ ${(en12186Min * 100).toFixed(1)}%)` :
                        `FAIL: EN 12186 requires ≥ ${(en12186Min * 100).toFixed(1)}% (${(floorArea * en12186Min).toFixed(3)} m²)`
                },
                igemTd13: {
                    minPercentage: igemMin,
                    pass: igemPass,
                    message: igemPass ? 
                        `PASS: Meets IGEM TD/13 (≥ ${(igemMin * 100).toFixed(1)}% - ${openingsSameWall ? 'same wall' : 'different walls'})` :
                        `FAIL: IGEM TD/13 requires ≥ ${(igemMin * 100).toFixed(1)}% (${(floorArea * igemMin).toFixed(3)} m²)`
                }
            };
            
            // Обновляем UI
            updateStandardsResults();
            
            return calculationLogs.standardsCheck;
        }

        function updateStandardsResults() {
            const resultsDiv = document.getElementById('standardsResults');
            const data = calculationLogs.standardsCheck;
            
            if (!data.floorArea) {
                resultsDiv.innerHTML = '<div class="result-item">No assessment performed</div>';
                return;
            }
            
            resultsDiv.innerHTML = `
                <div class="result-item">
                    <span>Floor Area:</span>
                    <span class="result-value">${formatNumber(data.floorArea, 2)} m²</span>
                </div>
                <div class="result-item">
                    <span>Total Ventilation Area:</span>
                    <span class="result-value">${formatNumber(data.totalVentArea, 3)} m²</span>
                </div>
                <div class="result-item">
                    <span>Ventilation Area Percentage:</span>
                    <span class="result-value">${(data.ventAreaPercentage * 100).toFixed(2)}%</span>
                </div>
                <div class="result-item">
                    <span>EN 12186:2014 Compliance:</span>
                    <span class="result-value ${data.en12186.pass ? 'pill ok' : 'pill bad'}">${data.en12186.pass ? 'PASS' : 'FAIL'}</span>
                </div>
                <div class="result-item">
                    <span>IGEM TD/13 Ed.3 Compliance:</span>
                    <span class="result-value ${data.igemTd13.pass ? 'pill ok' : 'pill bad'}">${data.igemTd13.pass ? 'PASS' : 'FAIL'}</span>
                </div>
                <div class="result-details">
                    ${data.en12186.message}<br>
                    ${data.igemTd13.message}
                </div>
            `;
        }

        function classifyHazardousArea() {
            console.log('Classify Hazardous Area called');
            
            const releaseGrade = document.getElementById('releaseGrade').value;
            const jetType = document.getElementById('jetType').value;
            
            // Определяем Qc для расчета зоны
            let qcForZone;
            if (calculationLogs.scenario === 'indoor' && calculationLogs.typeAOpening.q2) {
                // Для Type A Opening используем Q2
                qcForZone = calculationLogs.typeAOpening.q2;
            } else if (calculationLogs.releaseRate.qc) {
                // Для обычных выбросов используем Qc
                qcForZone = calculationLogs.releaseRate.qc;
            } else {
                qcForZone = 0;
            }
            
            // Обновляем поле Qc
            document.getElementById('qcForZone').value = formatNumber(qcForZone);
            
            // Получаем протяженность зоны из поля ввода
            const zoneExtent = parseFloat(document.getElementById('zoneExtentManual').value);
            
            // Определяем тип зоны на основе степени выброса
            let zoneType;
            switch(releaseGrade) {
                case 'continuous':
                    zoneType = 'Zone 0';
                    break;
                case 'primary':
                    zoneType = 'Zone 1';
                    break;
                case 'secondary':
                    zoneType = 'Zone 2';
                    break;
                default:
                    zoneType = 'Zone 2';
            }
            
            // Применяем правило 25% LFL для indoor помещений
            let finalExtent = zoneExtent;
            if (calculationLogs.scenario === 'indoor' && calculationLogs.indoorAssessment.xb >= calculationLogs.indoorAssessment.xCrit) {
                // Если фоновая концентрация превышает 25% LFL, увеличиваем зону
                finalExtent = Math.max(zoneExtent, 3.0); // Минимум 3 метра для плохой вентиляции
            }
            
            // Сохраняем результаты
            calculationLogs.zoneClassification = {
                releaseGrade: releaseGrade,
                jetType: jetType,
                qcForZone: qcForZone,
                zoneType: zoneType,
                zoneExtent: finalExtent
            };
            
            // Обновляем UI
            updateClassificationResults();
            updateSummary();
            
            return calculationLogs.zoneClassification;
        }

        function updateClassificationResults() {
            const resultsDiv = document.getElementById('classificationResults');
            const data = calculationLogs.zoneClassification;
            
            if (!data.zoneType) {
                resultsDiv.innerHTML = '<div class="result-item">No classification performed</div>';
                return;
            }
            
            let methodNote = '';
            if (calculationLogs.scenario === 'indoor') {
                methodNote = `<div class="result-details">Method note: Zone extent from Figure D.1 uses ${calculationLogs.typeAOpening.q2 ? 'Q₂ (Type A Opening)' : 'Qc'}; Xb is computed from ${calculationLogs.conservativeMode ? 'Qc (Conservative mode)' : 'Qg (Standard mode)'}</div>`;
                
                if (calculationLogs.indoorAssessment.xb >= calculationLogs.indoorAssessment.xCrit) {
                    methodNote += `<div class="warning-banner">25% LFL rule applied: Background concentration exceeds 25% LFL, zone extent adjusted</div>`;
                }
            }
            
            resultsDiv.innerHTML = `
                <div class="result-item">
                    <span>Grade of Release:</span>
                    <span class="result-value">${data.releaseGrade}</span>
                </div>
                <div class="result-item">
                    <span>Jet Type:</span>
                    <span class="result-value">${data.jetType}</span>
                </div>
                <div class="result-item">
                    <span>Qc for Zone Calculation:</span>
                    <span class="result-value">${formatNumber(data.qcForZone)} m³/s</span>
                </div>
                <div class="result-item">
                    <span>Hazardous Zone Type:</span>
                    <span class="result-value">${data.zoneType}</span>
                </div>
                <div class="result-item">
                    <span>Zone Extent:</span>
                    <span class="result-value">${formatNumber(data.zoneExtent, 2)} m</span>
                </div>
                ${methodNote}
            `;
        }

        function updateJetTypeFromCalculation() {
            const releaseData = calculationLogs.releaseRate;
            const jetTypeSelect = document.getElementById('jetType');
            
            if (!releaseData.isChoked) {
                return; // Не обновляем если нет данных
            }
            
            // Улучшенное автоматическое определение типа струи
            const gasDensity = releaseData.gasDensity;
            const airDensity = 1.2; // kg/m³
            
            if (releaseData.isChoked && releaseData.pressureRatio > 1.9) {
                jetTypeSelect.value = 'unimpeded';
            } else if (gasDensity > airDensity * 1.5) {
                jetTypeSelect.value = 'heavy';
            } else {
                jetTypeSelect.value = 'diffusive';
            }
        }

        function updateSummary() {
            // Обновляем сводку на основе всех расчетов
            document.getElementById('summaryScenario').textContent = 
                calculationLogs.scenario === 'outdoor' ? 'Outdoor Release' : 'Indoor Release';
            
            document.getElementById('summaryQc').textContent = 
                calculationLogs.releaseRate.qc ? 
                formatNumber(calculationLogs.releaseRate.qc) + ' m³/s' : '—';
            
            document.getElementById('summaryQ2').textContent = 
                calculationLogs.typeAOpening.q2 ? 
                formatNumber(calculationLogs.typeAOpening.q2) + ' m³/s' : '—';
            
            document.getElementById('summaryVentilation').textContent = 
                calculationLogs.outdoorAssessment.ventilationAvailability || 
                (calculationLogs.indoorAssessment.airFlowRate ? 'Available' : '—');
            
            document.getElementById('summaryDilution').textContent = 
                calculationLogs.outdoorAssessment.dilutionLevel || 
                calculationLogs.indoorAssessment.dilutionLevel || '—';
            
            document.getElementById('summaryZone').textContent = 
                calculationLogs.zoneClassification.zoneType || '—';
            
            document.getElementById('summaryExtent').textContent = 
                calculationLogs.zoneClassification.zoneExtent ? 
                formatNumber(calculationLogs.zoneClassification.zoneExtent, 2) + ' m' : '—';
            
            document.getElementById('summaryBackground').textContent = 
                calculationLogs.indoorAssessment.xb ? 
                formatNumber(calculationLogs.indoorAssessment.xb) + (calculationLogs.conservativeMode ? ' (Conservative)' : '') : '—';
        }

        function generateReport() {
            // Устанавливаем дату и время расчета
            calculationLogs.calculationDateTime = new Date();
            
            // Создаем подробный отчет
            let report = "HAC AND VENTILATION ASSESSMENT REPORT\n";
            report += "========================================\n\n";
            
            report += "CALCULATION METADATA\n";
            report += "-------------------\n";
            report += `Calculator Version: ${calculationLogs.calculatorVersion}\n`;
            report += `Calculation Date: ${calculationLogs.calculationDateTime.toISOString()}\n`;
            report += `Scenario: ${calculationLogs.scenario.toUpperCase()}\n`;
            report += `Standards: IEC 60079-10-1:2020, EN 12186:2014, IGEM TD/13 Ed.3, BS 5925:1991\n\n`;
            
            report += "GAS PROPERTIES\n";
            report += "-------------\n";
            report += `Gas Type: ${document.getElementById('gasType').options[document.getElementById('gasType').selectedIndex].text}\n`;
            report += `Molar Mass: ${document.getElementById('molarMass').value} kg/mol\n`;
            report += `Specific Heat Ratio (γ): ${document.getElementById('gamma').value}\n`;
            report += `LFL: ${(document.getElementById('lfl').value * 100).toFixed(2)}%\n`;
            report += `Temperature: ${document.getElementById('temp').value} K\n\n`;
            
            if (calculationLogs.releaseRate.massFlowRate) {
                report += "RELEASE RATE CALCULATION (IEC 60079-10-1 Annex B.7)\n";
                report += "-----------------------------------\n";
                report += `Hole Size: ${document.getElementById('holeSize').value} mm²\n`;
                report += `System Pressure: ${document.getElementById('pressure').value} bar ${document.querySelector('input[name="pressureType"]:checked').value}\n`;
                report += `Discharge Coefficient (Cₕ): ${document.getElementById('cd').value}\n`;
                report += `Mass Flow Rate: ${formatNumber(calculationLogs.releaseRate.massFlowRate)} kg/s\n`;
                report += `Volumetric Gas Inflow (Q₉): ${formatNumber(calculationLogs.releaseRate.qg)} m³/s\n`;
                report += `Release Characteristic (Q꜀): ${formatNumber(calculationLogs.releaseRate.qc)} m³/s\n`;
                report += `Flow Type: ${calculationLogs.releaseRate.isChoked ? 'Choked' : 'Subsonic'}\n\n`;
            }
            
            if (calculationLogs.outdoorAssessment.ventilationAvailability) {
                report += "OUTDOOR ASSESSMENT (IEC 60079-10-1 Annex C)\n";
                report += "-------------------------------------------\n";
                report += `Wind Speed: ${formatNumber(calculationLogs.outdoorAssessment.windSpeed, 2)} m/s\n`;
                report += `Ventilation Availability: ${calculationLogs.outdoorAssessment.ventilationAvailability}\n`;
                report += `Dilution Level: ${calculationLogs.outdoorAssessment.dilutionLevel}\n\n`;
            }
            
            if (calculationLogs.indoorAssessment.airFlowRate) {
                report += "INDOOR ASSESSMENT (IEC 60079-10-1 Annex C)\n";
                report += "------------------------------------------\n";
                report += `Air Flow Rate: ${formatNumber(calculationLogs.indoorAssessment.airFlowRate)} m³/s\n`;
                report += `Air Change Frequency: ${formatNumber(calculationLogs.indoorAssessment.airChangeFrequency)} s⁻¹\n`;
                report += `Type A Opening Q₂: ${formatNumber(calculationLogs.typeAOpening.q2)} m³/s\n`;
                report += `Background Concentration (Xb): ${formatNumber(calculationLogs.indoorAssessment.xb)}\n`;
                report += `Xb Calculation: ${calculationLogs.indoorAssessment.xbNote}\n`;
                report += `Dilution Level: ${calculationLogs.indoorAssessment.dilutionLevel}\n`;
                if (calculationLogs.indoorAssessment.xbWarning) {
                    report += `WARNING: ${calculationLogs.indoorAssessment.xbWarning}\n`;
                }
                report += `\n`;
            }
            
            if (calculationLogs.standardsCheck.floorArea && calculationLogs.scenario === 'indoor') {
                report += "STANDARDS COMPLIANCE CHECK\n";
                report += "-------------------------\n";
                report += `EN 12186:2014: ${calculationLogs.standardsCheck.en12186.message}\n`;
                report += `IGEM TD/13 Ed.3: ${calculationLogs.standardsCheck.igemTd13.message}\n\n`;
            }
            
            if (calculationLogs.zoneClassification.zoneType) {
                report += "ZONE CLASSIFICATION (IEC 60079-10-1 Annex D)\n";
                report += "--------------------------------------------\n";
                report += `Zone Type: ${calculationLogs.zoneClassification.zoneType}\n`;
                report += `Zone Extent: ${formatNumber(calculationLogs.zoneClassification.zoneExtent, 2)} m\n`;
                report += `Grade of Release: ${calculationLogs.zoneClassification.releaseGrade}\n`;
                report += `Jet Type: ${calculationLogs.zoneClassification.jetType}\n`;
                report += `Qc for Zone: ${formatNumber(calculationLogs.zoneClassification.qcForZone)} m³/s\n`;
                if (calculationLogs.scenario === 'indoor') {
                    report += `Method Note: Zone extent from Figure D.1 uses ${calculationLogs.typeAOpening.q2 ? 'Q₂ (Type A Opening)' : 'Qc'}; Xb computed from ${calculationLogs.conservativeMode ? 'Qc' : 'Qg'}\n`;
                }
            }
            
            if (calculationLogs.conservativeMode) {
                report += `\nASSUMPTIONS:\n`;
                report += `- Conservative mode active: Xb estimated with Qc for maximum conservatism\n`;
                report += `- Results may be intentionally conservative and not reflect base Annex C methodology\n`;
            }
            
            report += `\nCALCULATION STEPS:\n`;
            report += `-----------------\n`;
            calculationLogs.calculationSteps.forEach(step => {
                report += `[${step.timestamp}] ${step.step}: ${step.description} ${step.value !== null ? `= ${formatNumber(step.value)}` : ''}\n`;
            });
            
            return report;
        }

        function generateDetailedReport() {
            const report = generateReport();
            
            // Создание downloadable отчета
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `HAC_Report_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function showReport() {
            const report = generateReport();
            alert(report);
        }

        function toggleScenarioVisibility(scenario) {
            const outdoorTab = document.querySelector('.tab[data-tab="outdoor-assessment"]');
            const indoorTab = document.querySelector('.tab[data-tab="indoor-assessment"]');
            const standardsTab = document.querySelector('.tab[data-tab="standards-check"]');
            const outdoorContent = document.getElementById('outdoor-assessment');
            const indoorContent = document.getElementById('indoor-assessment');
            const standardsContent = document.getElementById('standards-check');
            
            // Показываем/скрываем элементы с классами outdoor-only и indoor-only
            document.querySelectorAll('.outdoor-only').forEach(el => {
                el.classList.toggle('hidden', scenario !== 'outdoor');
            });
            document.querySelectorAll('.indoor-only').forEach(el => {
                el.classList.toggle('hidden', scenario !== 'indoor');
            });
            
            if (scenario === 'outdoor') {
                outdoorTab.classList.remove('hidden');
                outdoorContent.classList.remove('hidden');
                indoorTab.classList.add('hidden');
                indoorContent.classList.add('hidden');
                standardsTab.classList.add('hidden');
                standardsContent.classList.add('hidden');
                
                // Активируем вкладку outdoor если indoor была активна
                if (indoorTab.classList.contains('active') || standardsTab.classList.contains('active')) {
                    indoorTab.classList.remove('active');
                    indoorContent.classList.remove('active');
                    standardsTab.classList.remove('active');
                    standardsContent.classList.remove('active');
                    outdoorTab.classList.add('active');
                    outdoorContent.classList.add('active');
                }
            } else {
                outdoorTab.classList.add('hidden');
                outdoorContent.classList.add('hidden');
                indoorTab.classList.remove('hidden');
                indoorContent.classList.remove('hidden');
                standardsTab.classList.remove('hidden');
                standardsContent.classList.remove('hidden');
                
                // Активируем вкладку indoor если outdoor была активна
                if (outdoorTab.classList.contains('active')) {
                    outdoorTab.classList.remove('active');
                    outdoorContent.classList.remove('active');
                    indoorTab.classList.add('active');
                    indoorContent.classList.add('active');
                }
            }
        }

        // Инициализация после загрузки DOM
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded - initializing calculator');
            
            // Language switching functionality
            const languageButtons = document.querySelectorAll('.language-btn');
            let currentLanguage = 'en';
            
            languageButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    currentLanguage = lang;
                    updateLanguage(lang);
                });
            });
            
            // Scenario selection functionality
            const scenarioButtons = document.querySelectorAll('.scenario-btn');
            
            scenarioButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const scenario = this.getAttribute('data-scenario');
                    calculationLogs.scenario = scenario;
                    
                    // Update active button
                    scenarioButtons.forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Toggle visibility of tabs
                    toggleScenarioVisibility(scenario);
                    
                    console.log('Scenario changed to:', scenario);
                });
            });
            
            // Tab functionality
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and contents
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(tc => tc.classList.remove('active'));
                    
                    // Add active class to current tab and content
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    console.log('Tab changed to:', tabId);
                });
            });
            
            // Основные кнопки калькулятора
            document.getElementById('calculateRelease').addEventListener('click', function() {
                console.log('Calculate Release button clicked');
                calculateReleaseRate();
            });
            
            document.getElementById('assessOutdoor').addEventListener('click', function() {
                console.log('Assess Outdoor button clicked');
                assessOutdoorConditions();
            });
            
            document.getElementById('assessEnclosed').addEventListener('click', function() {
                console.log('Assess Enclosed button clicked');
                assessEnclosedSpace();
            });
            
            document.getElementById('checkStandards').addEventListener('click', function() {
                console.log('Check Standards button clicked');
                checkVentilationStandardsCompliance();
            });
            
            document.getElementById('classifyArea').addEventListener('click', function() {
                console.log('Classify Area button clicked');
                classifyHazardousArea();
            });
            
            document.getElementById('generateReport').addEventListener('click', function() {
                console.log('Generate Report button clicked');
                showReport();
            });
            
            document.getElementById('generateDetailedReport').addEventListener('click', function() {
                console.log('Generate Detailed Report button clicked');
                generateDetailedReport();
            });
            
            // Gas type selector
            document.getElementById('gasType').addEventListener('change', function() {
                const gasType = this.value;
                if (gasType === 'propane') {
                    document.getElementById('molarMass').value = '0.044097';
                    document.getElementById('gamma').value = '1.13';
                    document.getElementById('lflPreset').value = 'common';
                    document.getElementById('lfl').value = '0.021';
                } else if (gasType === 'butane') {
                    document.getElementById('molarMass').value = '0.058123';
                    document.getElementById('gamma').value = '1.18';
                    document.getElementById('lflPreset').value = 'common';
                    document.getElementById('lfl').value = '0.015';
                }
                console.log('Gas type changed to:', this.value);
            });
            
            // LFL preset selector
            document.getElementById('lflPreset').addEventListener('change', function() {
                const preset = this.value;
                if (preset === 'common') {
                    // Для пропана 2.1%, для бутана 1.5%
                    const gasType = document.getElementById('gasType').value;
                    document.getElementById('lfl').value = gasType === 'propane' ? '0.021' : '0.015';
                } else if (preset === 'conservative') {
                    // Консервативные значения
                    const gasType = document.getElementById('gasType').value;
                    document.getElementById('lfl').value = gasType === 'propane' ? '0.017' : '0.014';
                }
                // Для 'custom' значение не меняется
                console.log('LFL preset changed to:', this.value);
            });
            
            // Pressure type conversion
            const pressureTypeRadios = document.querySelectorAll('input[name="pressureType"]');
            pressureTypeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    console.log('Pressure type changed to:', this.value);
                });
            });
            
            // Jet type change handler
            document.getElementById('jetType').addEventListener('change', function() {
                console.log('Jet type changed to:', this.value);
            });
            
            // Conservative mode handler
            document.getElementById('conservativeMode').addEventListener('change', function() {
                console.log('Conservative mode changed to:', this.checked);
                calculationLogs.conservativeMode = this.checked;
            });
            
            // Инициализация видимости сценариев
            toggleScenarioVisibility('outdoor');
            
            console.log('Calculator initialized successfully');
        });
    </script>
</body>
</html>
